<HEAD>
<TITLE>Installing Juggler</TITLE>
</HEAD>

<BODY>

<H2>Installing VR Juggler</H2>

<H3>Table of Contents:</H3>

  <OL>
    <LI><A HREF="#intro">Introduction</A>
    <LI><A HREF="#required">Required Reading</A>
    <LI><A HREF="#targets">Targets</A>
    <LI><A HREF="#variables">Useful Variables</A>
    <LI><A HREF="#steps">Process of Full Install (Individual Steps)</A>
    <LI><A HREF="#scripts">Custom Scripts</A>
  </OL>

<A NAME="intro"><H4>Introduction</H4></A>

  <P>
    To improve portability and consistency across platforms, VR Juggler
    uses GNU make for installing the library (compiling is covered
    <A HREF="${TEAMGUIDE}/build/juggler/use.compile.html">elsewhere</A>).
    The makefiles used employ many features that are unique to GNU make
    thus requiring that people who wish to compile Juggler from its source
    are required to have it installed.  The Juggler makefiles are known to
    to work with versions 3.76.1, 3.77.x and 3.78.1 of GNU make.  To make
    sense of this documentation, please understand the concepts listed in
    <A HREF="#required">Required Reading</A>.  Posting about these subjects
    to the mailing list will probably be ignored.
  </P>

  <P>
    In this file, the following conventions are used for text formatting
    and naming:

    <UL>
      <LI>
        Program, file and directory names are written in <TT>fixed-width
        font</TT>.
      </LI>
      <LI>
        Commands that are intended to be run by the user are written in
        <TT><B>bold fixed-width font</B></TT>.
      </LI>
      <LI>
        References to system and library calls are written as
        <I>call_name</I>(##) where ``##'' is the manual section where that
        call's documentation can be found.
      </LI>
      <LI>
        Makefile targets are named as `<TT>target</TT>', and makefile
        variables are named as <TT>${VAR_NAME}</TT>.
      </LI>
      <LI>
        Environment variables are named as <TT>ENV_VAR_NAME</TT>.  (This is
        to avoid confusion between UNIX and Win32 environments where
        environment variables are evaluated using <TT>$</TT>'s and
        <TT>%</TT>'s respectively.)
      </LI>
    </UL>
  </P>

<A NAME="required"><H4>Required Reading</H4></A>

  <UL>
    <LI>
      <A HREF="${TEAMGUIDE}/build/juggler/use.configure.html">Using the
      Juggler Configure Script</A>
    </LI>
    <LI>
      <A HREF="${TEAMGUIDE}/build/juggler/use.compile.html">Compiling
      Juggler</A>
    </LI>
    <LI>
      <A HREF="http://www.gnu.org/software/make/make.html">GNU make</A>
      documentation (try doing a <TT>man</TT> or <TT>info</TT> on `gmake' or
      on `make'; there also is a good book by
      <A HREF="http://www.ora.com/">O'Reilly &amp; Associates</A>)
    </LI>
  </UL>

<A NAME="targets"><H4>Targets</H4></A>

  <P>
    This section describes all the targets related to installing VR Juggler
    <I>from its source code</I>.  The targets are grouped together depending
    upon how they are related.  For information on what is actually done as
    part of the full installation process, <A HREF="#steps">see below</A>.
    A current list of all the targets (with descriptions) can be found at
    the top of <TT>Makefile.in</TT> in the top-level Juggler source
    directory.
  </P>

  <DL>
    <DT>`<TT>installworld</TT>' (same as `<TT>install-all</TT>')
      <DD>Full installation of library binaries (both debugging and optimized
          for the default ABI/ISA combination) and all associated files.  The
          steps taken for this installation are as described
          <A HREF="#steps">below</A>.  This is the essentially second phase
          of the `<TT>world</TT>' target described in the
          <A HREF="${TEAMGUIDE}/build/juggler/use.compile.html">compiling
          documentation</A>.  <I>It requires that `<TT>buildworld</TT>' be
          successfully completed beforehand.</I>
    <DT>`<TT>install-all-abi</TT>'
      <DD>This is the same as the `<TT>installworld</TT>' target except that
          it installs <I>all possible</I> ABI and ISA combinations for the
          target platform.  On IRIX, for example, this means that all
          combinations of N32, 64, mips3 and mips4 (debugging and optimized)
          are installed.  Most platforms currently support only one ABI/ISA
          combination thus making this target exactly the same as
          `<TT>installworld</TT>'.  The steps taken for this installation
          follow those described <A HREF="#steps">below</A>.
    <DT>`<TT>install-debug</TT>' (same as `<TT>install</TT>')
      <DD>Install only the debugging version of the library binaries (both
          static and dynamic) and all associated files.  It includes the
          combination of `<TT>install-dbg</TT>' and `<TT>install-ddso</TT>'
          (see below).  The steps taken for this installation follow those
          described <A HREF="#steps">below</A>.  <I>This is the target that
          is run when using the traditional <TT>make install</TT>
          command.</I>
    <DT>`<TT>install-dbg</TT>'
      <DD>Install only the <I>static</I> debugging version of the library
          binaries.  Nothing besides the libraries is installed.
    <DT>`<TT>install-ddso</TT>'
      <DD>Install only the <I>dynamic</I> debugging version of the library
          binaries.  Nothing besides the libraries is installed.
    <DT>`<TT>install-optim</TT>'
      <DD>Install only the optimized version of the library binaries (both
          static and dynamic) and all associated files.  It includes the
          combination of `<TT>install-opt</TT>' and `<TT>install-dso</TT>'
          (see below).  The steps taken for this installation follow those
          described <A HREF="#steps">below</A>.
    <DT>`<TT>install-opt</TT>'
      <DD>Install only the <I>static</I> optimized version of the library
          binaries.  Nothing besides the libraries is installed.
    <DT>`<TT>install-dso</TT>'
      <DD>Install only the <I>dynamic</I> optimized version of the library
          binaries.  Nothing besides the libraries is installed.
    <DT>`<TT>install-headers</TT>'
      <DD>Install all the header files from the Juggler source tree.
    <DT>`<TT>install-samples</TT>'
      <DD>Install the sample applications and generate all the application
          makefiles from the <TT>Makefile.in</TT> templates.  This makes a
          copy of the <TT>samples</TT> directory tree found in the Juggler
          source.
    <DT>`<TT>install-test</TT>'
      <DD>Install the test code and generate all the necessary makefiles
          from the <TT>Makefile.in</TT> templates.  This makes a copy of
          the <TT>test</TT> directory tree found in the Juggler source.
    <DT>`<TT>install-tools</TT>'
      <DD>Install the user tools and generate all the necessary makefiles
          from the <TT>Makefile.in</TT> templates.  This makes a copy of
          the <TT>tools</TT> directory tree found in the Juggler source.
    <DT>`<TT>install-data</TT>'
      <DD>Install the standard Juggler data files.  This makes a copy of
          the <TT>Data</TT> directory tree found in the Juggler source.
    <DT>`<TT>install-gui</TT>'
      <DD>Install the VjControl JAR file and its runnable files.  In a
          UNIX environment, the <TT>vjcontrol</TT> and <TT>vjcontrol1.1</TT>
          scripts are installed.  On a Win32 platform, the
          <TT>vjcontrol.bat</TT> batch file is installed.  This is done only
          if the configure script found a working Java compiler and the
          target is not being disabled via the <TT>${NO_JAVA_GUI}</TT>
          variable.
    <DT>`<TT>hier</TT>'
      <DD>Build the directory hierarchy for the installation.  This is
          done before any of the ``full'' install targets
          (`<TT>installworld</TT>', `<TT>install-all-abi</TT>',
          `<TT>install-debug</TT>' and `<TT>install-optim</TT>') is run.
          This is useful for testing parts of the installation or doing
          partial installations.  Run it before doing any testing to
          create the full install hierarchy and then run the selected
          install targets.  For example, to install only the static
          debugging libraries with nothing else, do:

<PRE>
    <B>make hier install-dbg</B>
</PRE>
  </DL>

<A NAME="variables"><H4>Useful Variables</H4></A>

  <P>
    As with all make-based build systems, variables used in the makefiles
    can be overridden by the user.  This section describes variables that
    developers may find useful to override while installing.  The variables
    are listed alphabetically.
  </P>

  <DL>
    <DT><TT>prefix</TT>
      <DD>Provide an alternate installation prefix than what was set at
          configuration time.  This is handy if testing the installation
          process or if no prefix was given at configuration time.
          Specifying a value for this variable is all that is necessary to
          change the entire installation path of Juggler.
    <DT><TT>vjABI</TT>
      <DD>Define an alternate ABI/ISA combination than the default set by
          <TT>configure</TT>.  This accepts exactly the same values as the
          <TT>--with-abi</TT> argument to the configure script.  Results of
          its use can be seen near the bottom of <TT>Makefile.base</TT>.
          If this was used as part of compiling, it must also be used for
          installing to ensure that everything is installed properly.
    <DT><TT>NO_JAVA_GUI</TT>
      <DD>Disable the installation of VjControl by setting this variable
          to <TT>1</TT> when building.  This is very helpful when VjControl
          is not building properly or is not needed for whatever reason.
    <DT><TT>PERL</TT>
      <DD>Provide a different version of a Perl 5.004 or newer binary than
          what <TT>configure</TT> found.  Perl is crucial to the
          installation process because several Perl scripts are used
          (<A HREF="#scripts">see below</A>).  If it necessary to use a
          different <TT>perl</TT> binary than the one that
          <TT>configure</TT> found, it can be named with this variable.
          All Perl scripts will use it.
  </DL>

<A NAME="steps"><H4>Process of Full Install (Individual Steps)</H4></A>

  <P>
    This section describes the steps taken by the ``full'' installation
    targets (`<TT>installworld</TT>', `<TT>install-all-abi</TT>',
    `<TT>install-debug</TT>' and `<TT>install-optim</TT>').  These targets
    install library binaries and all associated Juggler files (data files,
    VjControl, headers, sample apps, etc.).  The steps are:

    <OL>
      <LI>
        Do any pre-installation steps necessary.  This includes creating
        the entire installation directory hierarchy.
      </LI>
      <LI>
        Install the library binaries (those that are appropriate for the
        target being run).  <A HREF="#targets">See above</A> for
        information on which binaries are installed by which targets.  In
        particular, the `<TT>installworld</TT>' target sets up links in
        the installed <TT>lib</TT> directory pointing to the default
        library version (currently the debugging version).
      </LI>
      <LI>
        Install all the header files needed for compiling applications.
      </LI>
      <LI>
        Install all the sample code provided as examples of working VR
        Juggler applications.
      </LI>
      <LI>
        Install the test code provided for testing various aspects of VR
        Juggler (threads, math, input devices, etc.) to ensure that it
        is in good working order.
      </LI>
      <LI>
        Install the various user tools included as helper applications in
        using VR Juggler.
      </LI>
      <LI>
        Install all the data files (config files, gesture files, calibration
        tables, etc.).
      </LI>
      <LI>
        Install VjControl (if it was built).
      </LI>
      <LI>
        Do any post-installation steps necessary.  Currently, nothing is
        done at this stage except informing the user that installation is
        complete.
      </LI>
    </OL>
  </P>

<A NAME="scripts"><H4>Custom Scripts</H4></A>

  <P>
    The installation process heavily depends on scripts written for VR
    Juggler.  Most of the scripts themselves are generalized such that
    they are not specific to Juggler, and in the case of <TT>mtree.pl</TT>,
    the script is written to fill in if the <TT>mtree</TT>(1) application
    is not found by <TT>configure</TT>.  The use of each script is
    described in detail here.
  </P>

  <H5><TT>mtree</TT>(1) and <TT>mtree.pl</TT></H5>

    <P>
      <TT>mtree</TT>(1) is a utility for mapping directory hierarchies.  It
      dates back to 4.3BSD-Reno, and development of it has continued in
      FreeBSD and in NetBSD.  <TT>mtree.pl</TT> is a Perl script written to
      mimic the behavior of <TT>mtree</TT>(1) (the version distributed with
      FreeBSD 3.0) so that Juggler's installation can take advantage of its
      features on platforms without <TT>mtree</TT>(1).  The two are not
      completely functionally equivalent at this time, but the basic
      features needed by Juggler are present.
    </P>

    <P>
      The key aspect of <TT>mtree</TT>(1) that the Juggler installation
      uses is the creation of directory hierarchies from specification
      files (named with the extension <TT>.dist</TT>).  These specifications
      can be used to create the full installation tree with all directories
      guaranteed to have the same permissions and ownership.  The actual
      specification files are generated by <TT>configure</TT> from template
      files to allow maximum flexibility.  One key file,
      <TT>VJ.lib.dist</TT>, is generated by <TT>configure</TT> from scratch
      (i.e., without a template) so that it can take advantage of
      <TT>configure</TT>'s internal knowledge about the target platform.
    </P>

    <P>
      The options that are used during installation are the following:

      <DL>
        <DT><TT>-U</TT>
          <DD>If any of the owner, group or permissions for a directory do
              not match the specification, update them accordingly.  All
              three must be specified for a missing directory to be created.
              (Note that this extra stipulation is not yet implemented in
              <TT>mtree.pl</TT>.)  On a Win32 platform, the owner and group
              are essentially meaningless because the Perl 5 port does not
              implement the functions that can read and modify ownership.
        <DT><TT>-d</TT>
          <DD>Ignore everything except directory file types.  This is used
              only for ensuring the integrity of the directory hierarchy.
        <DT><TT>-e</TT>
          <DD>Ignore files in the hierarchy that are not in the specification.
              This is especially important since the Juggler specification
              files only contain directory information.
        <DT><TT>-f &lt;specification file&gt;</TT>
          <DD>Read from the named specification file rather than from the
              standard input.
        <DT><TT>-p &lt;path&gt;</TT>
          <DD>Start at the name directory rather than the current directory.
      </DL>
    </P>

    <P>
      <TT>mtree</TT>(1) provides a wide range of features but unfortunately
      not all are implemented in <TT>mtree.pl</TT>.  For example, besides
      being used to build a hierarchy, it can be used to generate a
      specification file for an existing hierarchy.  For more information
      about what can be done with this utility, refer to the manual page if
      <TT>mtree</TT>(1) is distributed with the operating system.  More
      work on bringing the two closer together in functional equivalence is
      anticipated.
    </P>

  <H5><TT>install-dir.pl</TT></H5>

    <P>
      This Perl 5 script is used to install an entire directory tree without
      any of the <TT>CVS</TT> directories.  Its use is very simple.  In
      general, the base of the tree to be installed and the destination
      directory are all that is necessary.  Options for the script are as
      follows:

      <DL>
        <DT><TT>-i &lt;source directory&gt;</TT> (required)
          <DD>Name the directory to be installed.
        <DT><TT>-o &lt;destination directory&gt;</TT> (required)
          <DD>Name the directory to which &lt;source directory&gt; is
              installed.
        <DT><TT>-u &lt;user name&gt;</TT> (optional)
          <DD>Name the user that will own the installed files and directories.
              This has no meaning on a Win32 platform.
        <DT><TT>-g &lt;group name&gt;</TT> (optional)
          <DD>Name the group that will own the installed files and
              directories.  This has no meaning on a Win32 platform.
        <DT><TT>-m &lt;mode&gt;</TT> (optional)
          <DD>Provide the permission bits (UNIX octal style) of the installed
              files.  Note that this sets the same permissions for
              <I>all</I> files.  If used in combination with
              <TT>mtree</TT>(1), permissions can be set on a per-file basis
              after this script is run.
      </DL>
    </P>

    <P>
      Currently, this script is used to install the <TT>Data</TT> directory
      since it contains no source files (see <TT>install-src.pl</TT>
      below), and it is used in the process of creating
      <TT>VjControl.jar</TT>.  Thus, it is versatile enough to be used
      during both the compile and install phases.
    </P>

  <H5><TT>install-src.pl</TT></H5>

    <P>
      Similar to <TT>install-dir.pl</TT>, this script installs the contents
      of a directory tree to a specified location.  It is, however, more
      selective in what it installs.  Only source files of recognized types
      (<TT>.txt</TT>, <TT>.TXT</TT>, <TT>.C</TT>, <TT>.c</TT>, <TT>.h</TT>,
      <TT>.cxx</TT>, <TT>.CXX</TT>, <TT>.cpp</TT>, <TT>.CPP</TT> and
      makefiles) are copied from the source to the destination.  Any
      <TT>CVS</TT> directories are not copied over.  The options for this
      script are exactly the same as those for <TT>install-dir.pl</TT>.
    </P>

  <H5><TT>makefiles-gen.pl</TT></H5>

    <P>
      This script is used to perform the same functions as <TT>configure</TT>
      when it expands the ``<TT>@...@</TT>'' strings in <TT>.in</TT>
      template files.  Its use is reserved for the installation phase
      rather than the configuration phase.  The installation process
      copies over many <TT>Makefile.in</TT>'s that <TT>configure</TT> would
      normally generate for use by developers.  To simplify maintenance,
      the same template files are used for installations that users can
      access.  Since the templates still contain the ``<TT>@...@</TT>''
      strings, they must be expanded again.  Thus, <TT>makefiles-gen.pl</TT>
      steps in for this purpose.
    </P>

    <P>
      Options for <TT>makefiles-gen.pl</TT> are slightly different from any
      of the other scripts.  It uses GNU-style options for the sake of
      clarity since some of the options correspond directly to a
      ``<TT>@...@</TT>'' string to be expanded.  The options described here
      are required unless otherwise noted.

      <DL>
        <DT><TT>--vars=&lt;filename&gt;</TT>
          <DD>The name of the file given for this option is a Perl file
              containing ``<TT>@...@</TT>'' substitution <I>values</I>.
	      These are used when replacing the ``<TT>@...@</TT>'' strings
	      in the template files.  For more information about this file,
	      see the paragraph following this list.  Note that the file
	      name given should be the one generated by <TT>configure</TT>
	      and not the <TT>.in</TT> template version.  The generated
	      file has the expanded strings that this script needs for its
	      job.
        <DT><TT>--srcdir=&lt;path&gt;</TT>
          <DD>This option is typically a simple value providing a path to
	      the source code <I>relative to the makefile</I>.  In almost
	      all cases, it will be `<TT>.</TT>' since the source code and
	      the <TT>Makefile</TT> being generated are in the same
	      directory.  This replaces <TT>@srcdir@</TT>.
        <DT><TT>--prefix=&lt;path&gt;</TT>
          <DD>Use this option to name the base directory where the
              <TT>Makefile</TT>'s will go.  For example, to generate the
              makefiles in the <TT>samples</TT> installed subtree, the
              path given is <TT>${prefix}/samples</TT>.
        <DT><TT>--startdir=&lt;path&gt;</TT>
          <DD>This option names the base of the directory tree containing
              the <I><TT>Makefile.in</TT> templates</I>.  In other words,
              it is a subdirectory in the Juggler source tree in which the
              recursive search for <TT>Makefile.in</TT>'s starts.
        <DT><TT>--SUBDIRS=&lt;directory list&gt;</TT>
          <DD>In conjunction with the previous option, name the directories
              to be searched for <TT>Makefile.in</TT> templates.  Only the
              directories here will be searched and used in the generation
              process.
        <DT><TT>--uname=&lt;owner's user name&gt;</TT> (optional)
          <DD>Give the name of the user who will own the installed files.
              This option has no meaning on a Win32 platform.
        <DT><TT>--gname=&lt;group name&gt;</TT> (optional)
          <DD>Give the name of the group that will own the installed files.
              This option has no meaning on a Win32 platform.
        <DT><TT>--mode=&lt;mode bits&gt;</TT> (optional)
          <DD>Give the permissions (UNIX octal style) to be set for the
              installed files.  This defaults to the running user's umask.
      </DL>
    </P>

    <P>
      The key to this script is <TT>VARS.pl.in</TT>, located in the top-level
      Juggler source directory.  It is a Perl file that can be evaluated at
      run time by the script to set values used for substitution.  The format
      used in the file is:

<PRE>
    $VARS{'<I>VAR_NAME</I>'} = '@<I>VAR_NAME</I>@';
</PRE>

      Note that <TT><I>VAR_NAME</I></TT> should be the same in both places
      for ease of understanding.  The <TT>%VARS</TT> hash is used in the
      substitution process.  Occurrences of its keys found in a
      <TT>Makefile.in</TT> are replaced with the value associated with that
      key (the expanded ``<TT>@...@</TT>'' string).  Also note the use of
      apostrophes to prevent expansion of variables by the Perl
      interpreter.  Be careful to use the right string delimiters when
      adding new values.
    </P>

  <H5>InstallOps Perl Module</H5>

    <P>
      Many of these Perl scripts use the InstallOps module (found in
      <TT>InstallOps.pm</TT> with the other scripts).  This module provides
      subroutines implementing commonly used techniques in working with
      directory trees and files during installation.  Ideally, it is general
      enough to be used in writing new scripts that can be added to the
      installation process.  A short description of the available subroutines
      and their use is provided here.

      <DL>
        <DT><TT>recurseDir($start_dir, $base_inst_dir)</TT>
          <DD>Recurse through the given directory tree beginning at
              <TT>$start_dir</TT>.  The second argument,
              <TT>$base_inst_dir</TT>, names the base directory to which
              the files will be installed.  This routine requires that the
              <I>calling package</I> define a subroutine called
              ``<TT>recurseAction()</TT>'' that defines what actions to
              take when a normal file is encountered during the recursion
              process.  It is only called when non-directory type files
              are found in the current directory of the recursion process.
              Since this is specialized for installation, it ensures that
              the destination directories (rooted at
              <TT>$base_inst_dir</TT>) exist.
        <DT><TT>newDir($base_dir, $newdir)</TT>
          <DD>Create a new directory (<TT>$newdir</TT>) in a given directory
              tree (<TT>$base_dir</TT>).  If it already exists, it is not
              created.
        <DT><TT>installFile($filename, $uid, $gid, $mode, $dest_dir)</TT>
          <DD>Install a given file (<TT>$filename</TT>) with specified
              permissions (<TT>$mode</TT>) in UNIX octal style to a
              destination directory (<TT>$dest_dir</TT>).  Ownership is set
              based on the provided values for <TT>$uid</TT> and
              <TT>$gid</TT> (which has no effect on a Win32 platform).
        <DT><TT>replaceTags($infile, %VARS)</TT>
          <DD>Replace tags of the form ``<TT>@...@</TT>'' in the given file
              (<TT>$infile</TT>) with known replacement values (found in
              <TT>%VARS</TT>).  The tags are the keys of <TT>%VARS</TT>,
              and the replacement values are the values associated with
              those keys.
      </DL>
    </P>

</BODY>

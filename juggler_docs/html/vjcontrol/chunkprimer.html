<html>

<title>VR Juggler Configuration Files and ConfigChunks</title>

<body bgcolor="#ffffcc">
<h2>VR Juggler Configuration Files and ConfigChunks</h2>

This file provides a very basic introduction to the concepts behind VR Juggler
configuration files - what they are, what they contain, etc.  It also 
introduces the idea of ConfigChunks - the building blocks of Juggler
config files.
<p>
The information on this page is essential to understanding how to modify
Juggler configurations and how to use the vjcontrol program.

<h2>Contents</h2>
<ul>
<li><a href="#chunkfiles">Configuration Files</a>
<li><a href="#chunks">What are ConfigChunks?</a>
<li><a href="#descfiles">Chunk Description Files</a>
<li><a href="#descs">What are Chunk Descriptions?</a>
</ul>



<a name="chunkfiles">
<h2>Configuration Files</h2>

<p>
When a VR Juggler application is initialized, it creates an internal
database of configuration information.  This database will contain information
about the kind of I/O devices available, the display windows Juggler should
open, and lots of other stuff.

<p>
Typically, this database will be filled up by reading one or more configuration
files.  With many Juggler applications, the names of config files to load
are given as command-line arguments when the program is run.  For example:

<pre>
       cubes ~/.vjconfig/sim.base.config ~/.vjconfig/sim.wand.mixin.config
</pre>

runs the <tt>cubes</tt> demo program and tells it to load two configuration
files.  <tt>sim.base.config</tt>, which gives a basic simulator-mode
configuration, is read into the configuration database.  Then 
<tt>sim.wand.mixin.config</tt>, which tells Juggler how to setup a 
simulation of a 3-button pointing device, is added.

<p>
Configuration files can be stored in serveral places:
<ul>
<li>The Juggler distribution contains a number of sample files in
<tt>$VJ_BASE_DIR/Data/configFiles/</tt>.  These include a number of
files for piecing together a simulator mode configuration, and a set
of example files based on the configuration of VRAC's C2 device.
<li>Juggler expects you to have a directory called <tt>.vjconfig</tt> in
your home directory.  This is a good place to put any config files that
you've chosen to modify.  For example, if you've changed one of the
simulator config files because you didn't like the keyboard shortcuts it
was using, you should put it in <tt>~/.vjconfig</tt>.
<li>Your system administrators may have also created a repository of
Juggler config files set up to work with your local systems and 
hardware.
</ul>

<p>
Some of the sample config files are designed to be used in a ``mix-n-match''
way.  For example, <tt>$VJ_BASE_DIR/Data/configFiles/</tt> contains four
files for use in simulator mode.  <tt>sim.base.config</tt> provides the
basic setup, and the other files add features on top of it - a pointing
device, or a simulated glove, or a set of analog inputs.



<a name="chunks">
<h2>What are ConfigChunks?</h2>
</a>

The building blocks of Juggler config files are pieces of data called
<i>ConfigChunks</i>, or <i>Chunks</i> for short.  There are many different
kinds of Chunks, and each one contains the complete configuration
information for a particular component of Juggler.  These components
can be things like display windows, input device drivers, the Juggler
performance measurement system, and so on.  To give you a better feel
for the concept, here's a list of some of the kinds of 
chunks used by Juggler beta1:

<ul>
<li><b>Sim Display</b> - Simulator-mode display window
<li><b>Surface Display</b> - Projection surface display window
<li><b>IBox</b> - Config for Ibox driver
<li><b>Flock</b> - Config for Flock of Birds tracking system driver
<li><b>Position Proxy</b> - Proxy for a positional device (e.g. the Flock)
<li><b>Performer API</b> - Setup info for Iris Performer-based apps
</dl>

When Juggler reads a configuration file, it compiles a list of all the 
ConfigChunks in the file and then tries to find a Juggler component
that knows how to deal with it.  For example, a Flock of Birds Chunk
would be passed to the Input Manager, which would create and activate
an instance of Juggler's Flock driver.

<p>
So what's inside a ConfigChunk?  Lots of stuff - and lots of 
<i>different</i> stuff, depending on what kind of Chunk it is.  After all,
the information the Input Manager needs to set up an input device doesn't
have a lot in common with what the Display Manager needs to open up
a display window.

<p>
The one thing that all Chunks have in common is that they all have names.
Names are used to distinguish between multiple Chunks of the same type.
For example, a configuration file for a CAVE-like device might define
several Surface Display Chunks, with names like "Front Wall", "Left Wall",
"Floor", and so on.  It's important that Chunks have unique names.  If
Juggler reads two ConfigChunks that have the same name, it will assume
that the second one is a redefinition or reconfiguration of the first
one, and it will forget the first one and just use the second definition.

<p>
The rest of the Chunk consists of a list of Properties.  Properties are
individual pieces  information.  Continuing our example with a Flock of
Birds tracking system, the Properties would include things like
the name of the serial port to connect to, the baud rate to use, the
positional offset, and so on.  To illustrate, here's what it looks like when
you view a single ConfigChunk in the vjcontrol program:

<p>
<img alt="ConfigChunk Demo Pic" src="gfx/ConfigChunkPic.png"></img>

<p>
"Instance Name" is the name of the Chunk - in this case, "flock_o_birds", 
while its type is "Flock" (the 
type is usually show in the window's title bar).  Below that are the
various properties - "Baud Rate", "Port", etc.  Different properties take
different kinds of values - Port takes a string, while Baud Rate takes an
integer.  The Translation property is interesting because it takes 
three separate floating point numbers.  There are also Boolean properties
and properties whose values are the names of other Chunks (so that
you can have Chunks that refer to other Chunks).
 


<a name="descfiles"></a>
<h2>Chunk Description Files</h2>

If you've read this far, you know what Juggler's config files are, and
you know what they're made of - lists of ConfigChunks.  You also know that
there are a lot of different kinds of ConfigChunks.  Where do these
different kinds of Chunks come from?  How does Juggler know how to make
a "Surface Display" Chunk that's different from a "Position Proxy" Chunk?

<p>
For every kind of ConfigChunk there's an object called a <i>ChunkDesc</i> - 
short for "Chunk Description".  ChunkDescs live in ChunkDesc files - and
where are they?  The primary Juggler ChunkDesc file is 
<tt>$VJ_BASE_DIR/Data/chunksDesc</tt> - it defines all the different kinds 
of chunks that Juggler beta1 knows about and needs.  When a Juggler
program starts up, one of the first things it does - even before it reads
its config files - is to read the primary chunksDesc file.

<p>
Later in the beta series, Juggler will have the ability to load
user-specific ChunkDesc files.  These might include ChunkDescs for
application-specific ConfigChunks.



<a name="descs"></a>
<h2>What is a Chunk Description?</h2>

So, a particular kind of ConfigChunk is defined by a ChunkDesc.  So what's
in a ChunkDesc?  Information about all the properties in the Chunk,
with their names, and types, and number of allowed values.  There's also
help strings and other information used to make the vjcontrol program 
a little more user-friendly.

Here's a breakdown of the contents of a ChunkDesc:

<ul>
<li><b>Name</b> - This string is the name of the type of ConfigChunk this
description defines.  In the examples we've used on this page, this would
be something like "Surface Display" or "Flock".

<li><b>Token</b> - Usually this is a short form of the name - no whitespace
allowed.  The token
is used by the Juggler library to refer to the Chunk type.  This means
that it's fairly safe to change the Name in a ChunkDesc - this will
just change the way things are labeled in the vjcontrol GUI - but
changing the token is a bad idea - Juggler could get confused and be
unable to recognize or load Chunks.  So, once you define a token, don't
change it unless you're prepared for the consequences.

<li><b>Help</b> - This is a short (one-line) help text, that should 
contain a description of what Chunks using this ChunkDesc are used for.

<li>A list of property descriptions.  This list always contains one
entry - Name.  That's the instance name property of a Chunk using this
description, as opposed to the name of the description itself.
<p>Other than that, the properties described will completely depend on
what Chunks using this description are trying to do.  Here's what's
in the description of a property:

<ul>
<li><b>Name</b> - The name of a property is simply a text string used to refer to it by the GUI, like "Serial Port" or "X Display Name". 

<li><b>Token</b> - The token is a lot like the name, and they are often the same string. The difference is that the token is used internally, in the config
  file format, and in the library itself when querying the configuration database. The token is restricted in a way similar to C/C++
  variable names: no whitespace is permitted, and it may not begin with a number. 

<li><b>Type</b> - There are four primitive types for properties: strings, integers, floating-point numbers, and booleans. In addition to these four
  types, Property values can also refer to other ConfigChunks. Example: The ConfigChunk for "general setup" might have a
  Property that lists the active Displays. The type for this Property could just be a string (matching the name of a Display
  ConfigChunk), but we can also make the Property type be "name of a Display ConfigChunk". This lets the GUI be a little smarter
  and easier to use when editing that property - but more on that later. 

<li><b>Number</b> - Most Properties have single values. Other times, as with our "Position Offset" example, a Property may need a fixed number of
  values. It is also possible for a Property to have a variable number of values; the list of active Displays mentioned above would be a
  good example. There may be no active displays, there may be 6, or 2, or just 1. 

<li><b>Value Lists (optional)</b> - Sometimes a Property might have a certain number of appropriate choices. For example, the handedness of a glove is either "Left"
  or "Right", and it would be nice if our GUI could display those as choices to the user, instead of requiring them to type in a string.
  The configuration system supports this with enumerations, which are simply lists of the appropriate values for a Property.
  Enumerations for string Properties are just lists of string values, while enumerations for integer and float Properties map
  descriptive strings to numeric values.

<li><b>Value Labels (optional)</b> - Some properties need to have several
values - for example three floating point numbers to define a point in 
space.  In this case, we can include value labels - short strings, one
for each of the values, such as "X coord", "Y coord", and "Z coord", or
"Length" and "Height".

</ul>
</ul>



</body>
</html>






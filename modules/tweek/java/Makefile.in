# **************** <Tweek heading BEGIN do not edit this line> ****************
# Tweek
#
# -----------------------------------------------------------------
# File:          $RCSfile$
# Date modified: $Date$
# Version:       $Revision$
# -----------------------------------------------------------------
# **************** <Tweek heading END do not edit this line> ******************

# ************** <auto-copyright.pl BEGIN do not edit this line> **************
#
# VR Juggler is (C) Copyright 1998, 1999, 2000, 2001 by Iowa State University
#
# Original Authors:
#   Allen Bierbaum, Christopher Just,
#   Patrick Hartling, Kevin Meinert,
#   Carolina Cruz-Neira, Albert Baker
#
# This library is free software; you can redistribute it and/or
# modify it under the terms of the GNU Library General Public
# License as published by the Free Software Foundation; either
# version 2 of the License, or (at your option) any later version.
#
# This library is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
# Library General Public License for more details.
#
# You should have received a copy of the GNU Library General Public
# License along with this library; if not, write to the
# Free Software Foundation, Inc., 59 Temple Place - Suite 330,
# Boston, MA 02111-1307, USA.
#
# *************** <auto-copyright.pl END do not edit this line> ***************

# -----------------------------------------------------------------------------
# Makefile.in for tweek/java.  It requires GNU make.
#
# Generated for use on @PLATFORM@
# -----------------------------------------------------------------------------

default: all

# Include common definitions.
include @topdir@/make.defs.mk

beandir			= $(bindir)/beans
srcdir			= @srcdir@
top_srcdir		= @top_srcdir@
EXTRA_SRCS_PATH		= $(srcdir)/../tweek/idl
EXTRA_JAVA_SRCS_PATH	= $(srcdir)/tweek
INSTALL			= @INSTALL@
JAVA_IDL_OPTS		= -emitAll -td $(srcdir)
JAVA_IDL_INCLUDES	= -i $(top_srcdir)

JDOM_JAR	= @JDOM_JAR@
OPENORB_JAR	= @OPENORB_JAR@
CLASSPATH	= $(JDOM_JAR)

IDL_JAVA_FILES	= SubjectManager.java	\
                  Subject.java		\
                  Observer.java

JAVA_SRCS	= org/vrjuggler/tweek/Tweek.java			\
                  org/vrjuggler/tweek/beans/BeanCollectionBuilder.java	\
                  org/vrjuggler/tweek/services/EnvironmentService.java	\
                  org/vrjuggler/tweek/iconviewer/BeanIconViewer.java	\
                  org/vrjuggler/tweek/treeviewer/BeanTreeViewer.java	\
                  tweek/SubjectManagerHolder.java			\
                  tweek/SubjectHolder.java				\
                  tweek/ObserverHolder.java

JARS		= Tweek.jar		\
                  TweekBeans.jar	\
                  TweekComm.jar
BEANS		= Viewers

# For the following, *.class is used so that these variables may be used as
# dependencies of .jar targets.

TWEEK_CLASSES	= org/vrjuggler/tweek/*.class			\
                  org/vrjuggler/tweek/services/*.class
TWEEK_EXTRAS	= org/vrjuggler/tweek/*.gif

BEANS_MF	= $(srcdir)/beans.MF
BEANS_CLASSES	= org/vrjuggler/tweek/beans/*.class		\
                  org/vrjuggler/tweek/beans/loader/*.class

COMM_CLASSES	= org/vrjuggler/tweek/net/*.class		\
                  org/vrjuggler/tweek/net/corba/*.class		\
                  tweek/*.class

SERVICE_MF	= $(srcdir)/services.MF
SERVICE_CLASSES	=

VIEWERS_MF	= $(srcdir)/viewers.MF
VIEWERS_CLASSES	= org/vrjuggler/tweek/iconviewer/*.class	\
                  org/vrjuggler/tweek/treeviewer/*.class
VIEWERS_EXTRAS	= org/vrjuggler/tweek/iconviewer/*.gif

include $(MKPATH)/dpp.obj.mk

# -----------------------------------------------------------------------------
# Extra targets.
# -----------------------------------------------------------------------------
jars: $(JARS) $(addsuffix .jar, $(BEANS))

Tweek.jar: $(TWEEK_CLASSES)
	$(JAR) cvf $@ $(TWEEK_CLASSES)
	cd $(srcdir) && $(JAR) uvf $(topdir)/java/$@ $(TWEEK_EXTRAS)

TweekComm.jar: $(COMM_CLASSES)
	$(JAR) cvf $@ $(COMM_CLASSES)

TweekBeans.jar: $(BEANS_MF) $(BEANS_CLASSES)
	$(JAR) cvfm $@ $(BEANS_MF) $(BEANS_CLASSES)

Viewers.jar: $(VIEWERS_CLASSES)
	$(JAR) cvfm $@ $(VIEWERS_MF) $(VIEWERS_CLASSES)
	cd $(srcdir) && $(JAR) uvf $(topdir)/java/$@ $(VIEWERS_EXTRAS)

Services.jar: $(SERVICE_CLASSES)
	$(JAR) cvfm $@ $(SERVICE_MF) $(SERVICE_CLASSES)

links:
	$(SHELL) $(MKINSTALLDIRS) $(instlinks)/bin/beans
	cd $(instlinks)/bin && rm -f ./*.jar
	cd $(instlinks)/bin &&						\
          for jar in $(JARS) ;						\
          do								\
              $(LN_S) $(topdir)/java/$$jar ./ ;				\
          done
	cd $(instlinks)/bin/beans && rm -f *.jar *.xml
	cd $(instlinks)/bin/beans &&					\
          for bean in $(BEANS) ;					\
          do								\
              $(LN_S) $(topdir)/java/$$bean.jar ./ ;			\
              $(LN_S) $(TWEEKROOT_ABS)/java/$$bean.xml ./ ;		\
          done
	cd $(instlinks)/bin &&						\
          for jar in `echo "$(JDOM_JAR)" | sed -e 's/$(JCPS)/ /g'` ;	\
          do								\
              $(LN_S) $$jar ./ ;					\
          done
	cd $(instlinks)/bin &&						\
          for jar in `echo "$(OPENORB_JAR)" | sed -e 's/$(JCPS)/ /g'` ;	\
          do								\
              $(LN_S) $$jar ./ ;					\
          done
	cd $(instlinks)/bin && rm -f ./tweek &&				\
          $(LN_S) $(TWEEKROOT_ABS)/java/tweek.sh ./tweek
	cd $(instlinks)/bin && rm -f ./java.security.policy.txt &&	\
          $(LN_S) $(TWEEKROOT_ABS)/java/java.security.policy.txt ./

# This cannot be named 'install' because Doozer++ already defines that.
tweek-install:
	@echo "------------------------------------------------"
	@echo "Installing the Tweek Java code base"
	@echo "------------------------------------------------"
ifeq (@OS_TYPE@, UNIX)
	$(INSTALL) -m $(EXEC_PERMS) $(GROUP_OPT_UNIX)			\
          $(TWEEKROOT_ABS)/java/tweek.sh $(bindir)/tweek
else
	$(INSTALL) -m $(EXEC_PERMS) $(GROUP_OPT_UNIX)			\
          $(TWEEKROOT_ABS)/java/tweek.bat $(bindir)/tweek.bat
endif	# if OS_TYPE == UNIX
	$(INSTALL) -m $(FILE_PERMS) $(GROUP_OPT_UNIX)			\
          $(topdir)/java/java.security.policy.txt $(bindir)
	for jar in $(JARS) ;						\
          do								\
              $(INSTALL) -m $(FILE_PERMS) $(GROUP_OPT_UNIX)		\
                $(topdir)/java/$$jar $(bindir) ;			\
          done
	for bean in $(BEANS) ;						\
          do								\
              $(INSTALL) -m $(FILE_PERMS) $(GROUP_OPT_UNIX)		\
                $(topdir)/java/$$bean.jar $(beandir) ;			\
              $(INSTALL) -m $(FILE_PERMS) $(GROUP_OPT_UNIX)		\
                $(topdir)/java/$$bean.xml $(beandir) ;			\
          done
	for jar in `echo "$(JDOM_JAR)" | sed -e 's/$(JCPS)/ /g'` ;	\
          do								\
              $(INSTALL) -m $(FILE_PERMS) $(GROUP_OPT_UNIX)		\
                $$jar $(bindir) ;					\
          done
	for jar in `echo "$(OPENORB_JAR)" | sed -e 's/$(JCPS)/ /g'` ;	\
          do								\
              $(INSTALL) -m $(FILE_PERMS) $(GROUP_OPT_UNIX)		\
                $$jar $(bindir) ;					\
          done

CLEAN_FILES	+= $(JARS)
CLEAN_DIRS	+= org tweek $(srcdir)/tweek


include Makefile.inc
